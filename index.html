<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="description" content>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="57TuruPNu5wqSSia_cUehl5t9Gh1AbxrHNPcMiFx-aQ" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NRFZ | Home</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    <meta property="og:image" content="https://i.imgur.com/i8n9KYs.png" />

    <link rel="icon" href="./img/core-img/favicon.png">

    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v7.0.0/css/all.css" />

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/style-breakpoints.css">
    <link rel="stylesheet" href="css/dark-mode.css">

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" href="css/carousel.css">


    <link rel="stylesheet" type="text/css"
        href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WN76281P3Q"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-WN76281P3Q');
    </script>

</head>

<style>
    .commitments-container {
        max-width: 500px;
        margin: 2rem auto;
        font-family: 'Segoe UI', Arial, sans-serif;
    }

    .commitments-table {
        width: 100%;
        border-collapse: collapse;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        background: #fff;
    }

    .commitments-table th,
    .commitments-table td {
        padding: 0.7em 1em;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }

    .header-main {
        background: #bdbdbd;
        color: #222;
        font-size: 1.2em;
        text-align: center;
    }

    .header-amount {
        background: #f48fb1;
        color: #fff;
        text-align: center;
    }

    .section-header.telco {
        background: #9575cd;
        color: #fff;
        font-weight: bold;
    }

    .section-header.subs {
        background: #c8e6c9;
        color: #222;
        font-weight: bold;
    }

    .total-row {
        background: #ede7f6;
        font-weight: bold;
    }

    .grand-total {
        background: #ffe082;
        font-size: 1.1em;
        font-weight: bold;
    }

    input[type="checkbox"] {
        transform: scale(1.2);
        accent-color: #7e57c2;
    }

    .delete-btn {
        background: none;
        border: none;
        color: #c62828;
        font-size: 1.1em;
        cursor: pointer;
        margin-left: 0.5em;
        display: none;
        vertical-align: middle;
    }

    tr:hover .delete-btn,
    tr.section-header:hover .delete-btn {
        display: inline;
    }

    .cat-name {
        background: #b2dfdb;
        color: #222;
        font-weight: bold;
    }

    .move-btn {
        background: none;
        border: none;
        color: #1976d2;
        font-size: 1.1em;
        cursor: pointer;
        margin-left: 0.3em;
        vertical-align: middle;
    }

    .category-row {
        background: #b2dfdb;
        font-weight: bold;
    }

    .category-header-row td {
        background: #b2dfdb;
        font-weight: bold;
        font-size: 1.08em;
        border-bottom: 2px solid #80cbc4;
        padding-top: 1em;
        padding-bottom: 0.5em;
    }

    .category-header-row input.cat-name {
        background: transparent;
        border: none;
        font-weight: bold;
        font-size: 1.08em;
        width: 100%;
        color: #222;
        outline: none;
        padding: 0.2em 0;
    }
</style>

<body>

    <!-- Navigation Bar -->
    <nav class="navbar-container">
        <div class="navbar">
            <!-- Logo -->
            <a href="index.html"><img src="img/core-img/logo.png" alt="logo" class="logo" /></a>

            <!-- Navigation Links -->
            <ul class="navbar-nav" id="navbarNav">
                <li class="nav-item">
                    <a href="#" class="nav-link active">
                        <i class="fa-solid fa-house"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="about.html" class="nav-link">
                        <i class="fa-solid fa-circle-user"></i>
                        <span>About</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="works-by-nrfz.html" class="nav-link">
                        <i class="fa-solid fa-pen-paintbrush"></i>
                        <span>Works By NRFZ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="eicw/eicw.html" class="nav-link">
                        <i class="fa-solid fa-map-location"></i>
                        <span>EICW</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="blog.html" class="nav-link">
                        <i class="fa-solid fa-comment"></i>
                        <span>Blog</span>
                    </a>
                </li>
                <li class="nav-item-toggle">
                    <a href="#" class="nav-link-toggle" id="dark-mode-toggle-desktop" title="Toggle Dark/Light Mode!">
                        <i class="fa-solid fa-moon-stars" id="theme-icon-desktop"></i>
                    </a>
                </li>
            </ul>

            <!-- Mobile Toggle -->
            <button class="mobile-toggle" id="mobileToggle">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
        </div>

        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <li class="mobile-menu-item mobile-theme-toggle">
                <a href="#" class="nav-link-toggle" id="dark-mode-toggle-mobile" title="Toggle Dark/Light Mode!">
                    <i class="fa-solid fa-moon-stars" id="theme-icon-mobile"></i>
                </a>
            </li>
            <a href="#" class="mobile-menu-brand">
                <span class="brand-text"></span>
            </a>
            <button class="mobile-menu-close" id="mobileMenuClose">
                <span>×</span>
            </button>
        </div>

        <ul class="mobile-menu-nav">
            <li class="mobile-menu-item">
                <a href="#" class="mobile-menu-link active">
                    <i class="fa-solid fa-regular fa-house"></i>
                    <span>Home</span>
                </a>
            </li>
            <li class="mobile-menu-item">
                <a href="about.html" class="mobile-menu-link">
                    <i class="fa-solid fa-regular fa-circle-user"></i>
                    <span>About</span>
                </a>
            </li>
            <li class="mobile-menu-item">
                <a href="works-by-nrfz.html" class="mobile-menu-link">
                    <i class="fa-solid fa-pen-paintbrush"></i>
                    <span>Works By NRFZ</span>
                </a>
            </li>
            <li class="mobile-menu-item">
                <a href="eicw/eicw.html" class="mobile-menu-link">
                    <i class="fa-solid fa-map-location"></i>
                    <span>EICW</span>
                </a>
            </li>
            <li class="mobile-menu-item">
                <a href="blog.html" class="mobile-menu-link">
                    <i class="fa-solid fa-comment"></i>
                    <span>Blog</span>
                </a>
            </li>
        </ul>
    </div>


    <!-- ============================================= Hero Section ============================================= -->
    <!-- <section id="hero" class="d-flex flex-column justify-content-center">
    </section> -->

    <div class="main-content">

        <!-- Title/Breadcrumbs -->
        <section class="about-me-sum clearfix" style="margin-top: 7em;">
            <div class="wbnrfz_eicw">
                <div class="page-header-section">
                    <div class="container-xxl container-mobile container-mobile-header">
                        <div class="breadcrumb-wrapper">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item">
                                        <a href="index.html">
                                            <i class="fa-solid fa-house"></i>
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a href="#">Commitments Tracker</a>
                                    </li>
                                    <!-- <li class="breadcrumb-item active" aria-current="page">
                                    EICW
                                </li> -->
                                </ol>
                            </nav>
                            <div class="page-title-wrapper">
                                <h1 class="page-title-single">Commitments Tracker</h1>
                            </div>
                        </div>
                    </div>

                    <div class="scrollable-tabs-container">
                        <div class="left-arrow">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                            </svg>

                        </div>

                        <ul>
                            <li>
                                <a href="#" class="active">Commitments Breakdown</a>
                            </li>

                            <li>
                                <a href="#">Pay Breakdown</a>
                            </li>

                            <li>
                                <a href="#">Repayments Tracker</a>
                            </li>
                        </ul>

                        <div class="right-arrow active">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                            </svg>

                        </div>
                    </div>
                    <hr>
                </div>

            </div>

        </section>

        <section>

            <div style="text-align:center; margin-bottom:1em;">
                <button id="addCategoryBtn" type="button" class="btn btn-primary">Add Category</button>
            </div>

            <div id="addModal"
                style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); align-items:center; justify-content:center;">
                <div
                    style="background:#fff; padding:2em 1.5em; border-radius:8px; max-width:90vw; width:350px; margin:auto; position:relative;">
                    <button id="closeModalBtn"
                        style="position:absolute; right:1em; top:1em; background:none; border:none; font-size:1.2em; cursor:pointer;">&times;</button>
                    <div id="modalContent"></div>
                </div>
            </div>

            <!-- Commitments Table Example -->
            <div class="commitments-container">
                <table class="commitments-table">
                    <thead>
                        <th colspan="6" class="header-amount">
                            Allocated Amount:
                            <input id="allocatedAmountInput" type="text"
                                style="width:100px; font-weight:bold; text-align:right;" />
                        </th>
                        <tr>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Deduction Period</th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Example category row -->
                        <!--
                        <tr class="category-row">
                            <td><input value="Category Name" class="cat-name"></td>
                            <td contenteditable="true">Description</td>
                            <td contenteditable="true">$0.00</td>
                            <td contenteditable="true">every ...</td>
                            <td><input type="checkbox"></td>
                            <td>
                                <button class="move-btn up" title="Move Up"><i class="fa-solid fa-arrow-up"></i></button>
                                <button class="move-btn down" title="Move Down"><i class="fa-solid fa-arrow-down"></i></button>
                                <button class="delete-btn" title="Delete"><i class="fa-solid fa-trash"></i></button>
                            </td>
                        </tr>
                        -->

                    </tbody>
                    <tfoot>
                        <tr class="grand-total">
                            <td colspan="5">Grand Total</td>
                            <td id="grandTotalCell"></td>
                        </tr>
                        <tr class="grand-total">
                            <td colspan="5">Balance Remaining</td>
                            <td id="balanceRemainingCell"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-social">
                    <a href="https://github.com/nurafianZulkifli" class="social-link">
                        <i class="fa-brands fa-github" aria-hidden="true"></i>
                    </a>
                    <a href="https://twitter.com/nrfzlkf_" class="social-link">
                        <i class="fa-brands fa-x-twitter" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.facebook.com/Nrfnzlkf/" class="social-link">
                        <i class="fa-brands fa-facebook" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.instagram.com/nrfzlkf/" class="social-link">
                        <i class="fa-brands fa-instagram" aria-hidden="true"></i>
                    </a>
                </div>
            </div>

            <div class="footer-copy">
                © 2025 Nurafian Zulkifli
            </div>
        </footer>
    </div>

    <script type="text/javascript" id="cookiebanner" src="js/cookies-banner.js" data-position="bottom" data-bg="#f2f3e5"
        data-fg="#000" data-font-family="Onest, sans-serif" data-zindex="12345111111"
        data-message="This website uses cookies to provide necessary site functionality and to improve your experience. By using this website, you agree to our use of cookies.">
        </script>

    <script src="js/navtabs.js"></script>

    <script src="js/theme-index.js"></script>

    <script src="js/jquery.min.js"></script>

    <script src="js/popper.min.js"></script>

    <script src="js/bootstrap.min.js"></script>

    <script src="js/pw.bundle.js"></script>

    <script src="js/default-assets/active.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Modal logic
            const modal = document.getElementById('addModal');
            const modalContent = document.getElementById('modalContent');
            const closeModalBtn = document.getElementById('closeModalBtn');
            function openModal(html, onSubmit) {
                modalContent.innerHTML = html;
                modal.style.display = 'flex';
                setTimeout(() => {
                    const form = modalContent.querySelector('form');
                    if (form) {
                        form.onsubmit = function (e) {
                            e.preventDefault();
                            onSubmit(new FormData(form));
                            modal.style.display = 'none';
                        };
                    }
                }, 10);
            }
            closeModalBtn.onclick = () => { modal.style.display = 'none'; };
            window.onclick = function (event) {
                if (event.target === modal) modal.style.display = 'none';
            };

            // Helper: parse $amount string to float
            function parseAmount(str) {
                if (!str) return 0;
                let n = str.replace(/[^0-9.\-]/g, '');
                return parseFloat(n) || 0;
            }

            // --- Allocated Amount Logic ---
            const allocatedAmountInput = document.getElementById('allocatedAmountInput');
            function getAllocatedAmount() {
                let val = allocatedAmountInput.value || "0";
                val = val.replace(/[^0-9.\-]/g, '');
                return parseFloat(val) || 0;
            }
            function saveAllocatedAmount() {
                localStorage.setItem('commitments_allocated_amount', allocatedAmountInput.value);
            }
            function loadAllocatedAmount() {
                let val = localStorage.getItem('commitments_allocated_amount');
                allocatedAmountInput.value = val !== null ? val : "0.00";
            }
            allocatedAmountInput.addEventListener('input', function () {
                saveAllocatedAmount();
                recalcTotals();
            });


            // --- Table Data Persistence ---
            function getTableData() {
                const tbody = document.querySelector('.commitments-table tbody');
                let data = [];
                let rows = Array.from(tbody.children);
                for (let i = 0; i < rows.length; i++) {
                    if (rows[i].classList.contains('category-header-row')) {
                        const catName = rows[i].querySelector('.cat-name').value;
                        let details = [];
                        let j = i + 1;
                        while (j < rows.length && rows[j].classList.contains('category-detail-row')) {
                            const tds = rows[j].children;
                            details.push({
                                desc: tds[0].textContent.trim(),
                                amount: tds[1].textContent.trim(),
                                period: tds[2].textContent.trim(),
                                checked: tds[3].querySelector('input[type="checkbox"]').checked
                            });
                            j++;
                        }
                        data.push({
                            category: catName,
                            details: details
                        });
                        i = j - 1;
                    }
                }
                return data;
            }

            function setTableData(rawData) {
                // Always flatten to a flat array of {category, desc, amount, period, checked}
                let flat = [];
                if (Array.isArray(rawData)) {
                    rawData.forEach(group => {
                        if (group.category && group.details) {
                            group.details.forEach(detail => {
                                flat.push({
                                    category: group.category,
                                    desc: detail.desc,
                                    amount: detail.amount,
                                    period: detail.period,
                                    checked: detail.checked
                                });
                            });
                        } else if (group.category && group.desc !== undefined) {
                            flat.push({
                                category: group.category,
                                desc: group.desc,
                                amount: group.amount,
                                period: group.period,
                                checked: group.checked
                            });
                        } else if (typeof group === "object" && !Array.isArray(group)) {
                            // If group is a grouped object (shouldn't happen, but just in case)
                            Object.entries(group).forEach(([catName, details]) => {
                                details.forEach(detail => {
                                    flat.push({
                                        category: catName,
                                        desc: detail.desc,
                                        amount: detail.amount,
                                        period: detail.period,
                                        checked: detail.checked
                                    });
                                });
                            });
                        }
                    });
                } else if (rawData && typeof rawData === "object") {
                    // If rawData is an object (grouped by category)
                    Object.entries(rawData).forEach(([catName, details]) => {
                        if (Array.isArray(details)) {
                            details.forEach(detail => {
                                flat.push({
                                    category: catName,
                                    desc: detail.desc,
                                    amount: detail.amount,
                                    period: detail.period,
                                    checked: detail.checked
                                });
                            });
                        }
                    });
                }

                // Now group by category name
                const grouped = {};
                flat.forEach(entry => {
                    if (!grouped[entry.category]) grouped[entry.category] = [];
                    grouped[entry.category].push({
                        desc: entry.desc,
                        amount: entry.amount,
                        period: entry.period,
                        checked: entry.checked
                    });
                });

                const tbody = document.querySelector('.commitments-table tbody');
                tbody.innerHTML = '';
                Object.entries(grouped).forEach(([catName, details]) => {
                    // Category name row
                    const headerTr = document.createElement('tr');
                    headerTr.className = 'category-header-row';
                    headerTr.setAttribute('draggable', 'true');
                    headerTr.innerHTML = `
                        <td colspan="6">
                            <input value="${catName}" class="cat-name" />
                        </td>
                    `;
                    tbody.appendChild(headerTr);

                    // Details rows
                    details.forEach(detail => {
                        const detailTr = document.createElement('tr');
                        detailTr.className = 'category-detail-row';
                        detailTr.innerHTML = `
                <td contenteditable="true">${detail.desc}</td>
                <td contenteditable="true">${detail.amount}</td>
                <td contenteditable="true">${detail.period}</td>
                <td><input type="checkbox"${detail.checked ? ' checked' : ''}></td>
                <td></td>
                <td>
                    <button class="delete-btn" title="Delete"><i class="fa-solid fa-trash"></i></button>
                </td>
            `;
                        tbody.appendChild(detailTr);
                    });
                });
                addRowHandlers();
                recalcTotals();
                addDragAndDropHandlers();
            }

            function saveTableToLocalStorage() {
                const data = getTableData();
                localStorage.setItem('commitments_table_data', JSON.stringify(data));
            }

            function loadTableFromLocalStorage() {
                const data = localStorage.getItem('commitments_table_data');
                if (data) setTableData(JSON.parse(data));
            }

            function recalcTotals() {
                let grandTotal = 0;
                document.querySelectorAll('.commitments-table tbody tr.category-detail-row').forEach(tr => {
                    const amt = parseAmount(tr.children[1].textContent);
                    grandTotal += amt;
                });
                // Update grand total
                const grandTotalCell = document.getElementById('grandTotalCell');
                if (grandTotalCell) {
                    grandTotalCell.textContent = '$' + grandTotal.toFixed(2);
                }
                // Update balance remaining
                const balanceCell = document.getElementById('balanceRemainingCell');
                if (balanceCell) {
                    const allocated = getAllocatedAmount();
                    const balance = allocated - grandTotal;
                    balanceCell.textContent = '$' + balance.toFixed(2);
                }
            }

            function addRowHandlers() {
                // Editable fields
                document.querySelectorAll('.commitments-table td[contenteditable]').forEach(cell => {
                    cell.onblur = function () {
                        saveTableToLocalStorage();
                        recalcTotals();
                    };
                    cell.onkeydown = function (e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            cell.blur();
                        }
                    };
                });
                // Category name input
                document.querySelectorAll('.cat-name').forEach(input => {
                    input.onblur = saveTableToLocalStorage;
                });
                // Checkbox
                document.querySelectorAll('.commitments-table input[type="checkbox"]').forEach(cb => {
                    cb.onchange = saveTableToLocalStorage;
                });
                // Delete
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.onclick = function (e) {
                        e.stopPropagation();
                        const detailTr = btn.closest('tr');
                        const headerTr = detailTr.previousElementSibling;
                        // If previous row is header and next row is not header, just remove detail row
                        // If this is the last detail row for a category, also remove header
                        if (
                            headerTr &&
                            headerTr.classList.contains('category-header-row') &&
                            (!detailTr.nextElementSibling ||
                                detailTr.nextElementSibling.classList.contains('category-header-row'))
                        ) {
                            headerTr.remove();
                        }
                        detailTr.remove();
                        saveTableToLocalStorage();
                        recalcTotals();
                    };
                });
            }

            // --- Drag and Drop Logic ---
            function addDragAndDropHandlers() {
                const headerRows = document.querySelectorAll('.commitments-table tbody tr.category-header-row');
                let dragSrc = null;

                headerRows.forEach(headerRow => {
                    headerRow.addEventListener('dragstart', function (e) {
                        dragSrc = headerRow;
                        headerRow.style.opacity = '0.5';
                        e.dataTransfer.effectAllowed = 'move';
                    });

                    headerRow.addEventListener('dragend', function () {
                        dragSrc = null;
                        headerRow.style.opacity = '';
                    });

                    headerRow.addEventListener('dragover', function (e) {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                        headerRow.style.borderTop = '2px solid #1976d2';
                    });

                    headerRow.addEventListener('dragleave', function () {
                        headerRow.style.borderTop = '';
                    });

                    headerRow.addEventListener('drop', function (e) {
                        e.preventDefault();
                        headerRow.style.borderTop = '';
                        if (dragSrc && dragSrc !== headerRow) {
                            const tbody = headerRow.parentNode;
                            // Move header and all its detail rows
                            let srcDetailRows = [];
                            let next = dragSrc.nextElementSibling;
                            while (next && next.classList.contains('category-detail-row')) {
                                srcDetailRows.push(next);
                                next = next.nextElementSibling;
                            }
                            // Insert before target header
                            tbody.insertBefore(dragSrc, headerRow);
                            srcDetailRows.forEach(row => {
                                tbody.insertBefore(row, headerRow);
                            });
                            saveTableToLocalStorage();
                            recalcTotals();
                        }
                    });
                });
            }



            // --- Initial load ---
            loadAllocatedAmount();
            loadTableFromLocalStorage();
            addRowHandlers();
            addDragAndDropHandlers();
            recalcTotals();


            // Add Category Button
            document.getElementById('addCategoryBtn').onclick = function () {
                openModal(`
            <form>
                <h3 style="margin-top:0;">Add Category</h3>
                <label>Category Name:<br><input name="cat" required style="width:100%;"></label><br><br>
                <label>Description:<br><input name="desc" required style="width:100%;"></label><br><br>
                <label>Amount:<br><input name="amount" required value="$0.00" style="width:100%;"></label><br><br>
                <label>Deduction Period:<br><input name="period" required value="every ..." style="width:100%;"></label><br><br>
                <label><input type="checkbox" name="checked"> Checked</label><br><br>
                <button type="submit">Add</button>
            </form>
        `, function (formData) {
                    // Load current data, add new entry, then re-group and render
                    let rawData = getTableData();
                    // Flatten to array of entries for grouping
                    let flat = [];
                    rawData.forEach(group => {
                        if (group.category && group.details) {
                            // grouped format
                            group.details.forEach(detail => {
                                flat.push({
                                    category: group.category,
                                    desc: detail.desc,
                                    amount: detail.amount,
                                    period: detail.period,
                                    checked: detail.checked
                                });
                            });
                        } else if (group.category && group.desc !== undefined) {
                            // flat format (single entry)
                            flat.push({
                                category: group.category,
                                desc: group.desc,
                                amount: group.amount,
                                period: group.period,
                                checked: group.checked
                            });
                        } else if (group.details === undefined) {
                            // grouped object format (from setTableData's grouped object)
                            Object.entries(group).forEach(([catName, details]) => {
                                details.forEach(detail => {
                                    flat.push({
                                        category: catName,
                                        desc: detail.desc,
                                        amount: detail.amount,
                                        period: detail.period,
                                        checked: detail.checked
                                    });
                                });
                            });
                        }
                    });
                    // Add new entry
                    flat.push({
                        category: formData.get('cat'),
                        desc: formData.get('desc'),
                        amount: formData.get('amount'),
                        period: formData.get('period'),
                        checked: !!formData.get('checked')
                    });
                    setTableData(flat);
                    saveTableToLocalStorage();
                    recalcTotals();
                });
            };

            // Remove "Add Item" button if not needed
            document.getElementById('addItemBtn').style.display = 'none';

            // Save on direct edits
            document.querySelectorAll('.commitments-table').forEach(table => {
                table.addEventListener('input', function (e) {
                    if (e.target.matches('td[contenteditable]')) {
                        recalcTotals();
                        saveTableToLocalStorage();
                    }
                });
            });
        });
    </script>




</body>

</html>